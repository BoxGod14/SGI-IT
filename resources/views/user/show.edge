<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Usuario</title>    
    @entryPointStyles('scss')
</head>
<body>
  <script defer src="../js/ticket-url.js"></script>
  <script defer src="../js/users.js"></script>
    <main>
      @include('partials/nav.edge')
    <div>
      @include('partials/header.edge')
      <div>
        <section class="userData">
          <section class="user-mainInfo">
            <div>
              <h4>Detalles del usuario</h4>
              <img src="" alt="Foto de usuario">
            </div>       
            <div>
              <h4>{{user.profile.fullName}}</h4>
              <div>
                <div>
                  <p>Correo electronico</p>
                  <p>{{user.email}}</p>
                </div>
                <div>
                  <p>Puesto</p>
                  <p>
                    @if(user.profile.jobPosition)
                      {{user.profile.jobPosition}}
                    @else
                      -
                    @end
                  </p>
                </div>                
                <div>
                  <p>Número de teléfono</p>
                  <p>
                    @if(user.profile.phoneNumber)
                      {{user.profile.phoneNumber}}
                    @else
                      -
                    @end
                  </p>
                </div>
              </div>              
            </div> 
            <div id="selectors">
              <ul>
                <li class="selected" data-selector="userInfo">Información del usuario</li>
                <li data-selector="tickets-requester" >Tickets creados</li>
                @if(user.roles != Roles.REQUESTER)
                  <li data-selector="tickets-technician" >Tickets asignados</li>
                @end
              </ul>
            </div>
          </section>
          <section class="extraInfo">              
              <div id="userInfo">
                <h4>Información adicional</h4>
                  <div>
                      <p>Nombre</p>
                      <p>{{user.profile.name}}</p>
                  </div>
                  <div>
                      <p>Apellidos</p>
                      <p>{{user.profile.surname}}</p>
                  </div>
                  <div>
                      <p>Fecha de nacimiento</p>
                      <p>{{user.profile.birthday.toFormat('dd/MM/yyyy')}}</p>
                  </div>
                  <div>
                      <p>Fecha de creacion</p>
                      <p>{{user.profile.createdAt.toFormat('dd/MM/yyyy')}}</p>
                  </div>
              </div>
              <div id="tickets-requester" class="tickets-user">
                @each(ticket in user.tickets)
                  @if(ticket.$extras.pivot_role == Roles.REQUESTER)
                  <div class="ticket" data-url="{{route('TicketsController.show', [ticket.id])}}">
                    <div><p><i class="material-icons">confirmation_number</i></p></div>                    
                    <div>
                      <section>
                        <p class="subject"
                        @if(ticket.state == State.SOLVED)
                          style="color:gray"
                        @end
                        >{{ticket.subject}}</p>
                        <p class="id">#{{ticket.id}}</p>
                      </section>
                      <section>                                        
                        <p class="createdAt">Creado hace: {{ticket.timeCreated}}</p>
                        <p class="state">Estado: {{ticket.state}}</p>
                        @each(user in ticket.User)
                          @if(user.$extras.pivot_role == Roles.TECHNICIAN)
                          <p>Tecnico: <a class="technician" href="{{route('UsersController.show', [user.id])}}">{{user.profile.fullName}}</a></p>
                          @endif
                        @endeach                      
                      </section>
                    </div>
                  </div>
                  @endif                  
                @endeach
              </div>
              {{--Mostrar solo si el usuario que se muestra es tecnico--}}
              @if(user.roles != Roles.REQUESTER)
                <div id="tickets-technician" class="tickets-user">
                  @each(ticket in user.tickets)
                    @if(ticket.$extras.pivot_role == Roles.TECHNICIAN)
                      <div class="ticket" data-url="{{route('TicketsController.show', [ticket.id])}}">
                        <div><p><i class="material-icons">confirmation_number</i></p></div>                    
                        <div>
                          <section>
                            <p class="subject"
                            @if(ticket.state == State.SOLVED)
                              style="color:gray"
                            @end
                            >{{ticket.subject}}</p>
                            <p class="id">#{{ticket.id}}</p>
                          </section>
                          <section>                                        
                            <p class="createdAt">Creado hace: {{ticket.timeCreated}}</p>
                            <p class="state">Estado: {{ticket.state}}</p>
                            @each(user in ticket.User)
                              @if(user.$extras.pivot_role == Roles.REQUESTER)
                              <p>Solicitante: <a class="technician" href="{{route('UsersController.show', [user.id])}}">{{user.profile.fullName}}</a></p>
                              @endif
                            @endeach                      
                          </section>
                        </div>
                      </div>
                    @endif                  
                  @endeach
                </div>                
              @endif
          </section>
        </section>
      </div>
    </div>
  </main>
  @include('partials/scripts/transitionsSwup_js.edge')    
</body>
</html>